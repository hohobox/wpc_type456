; \brief AUTOSAR BSW Basic Software Modules
;
; This file is used for triggering watchdog hardware.
; This code is expanded into RAM when WdgRunArea is set to RAM.
;
; Do not edit this file manually.
; Any change might compromise the safety integrity level of
; the software partition it is contained in.
;
; Product: SW-MCAL42-DRV
;
; (c) 2017-2022, Cypress Semiconductor Corporation (an Infineon company) or
; an affiliate of Cypress Semiconductor Corporation.  All rights reserved.
; This software, including source code, documentation and related materials
; ("Software") is owned by Cypress Semiconductor Corporation or one of
; its affiliates ("Cypress") and is protected by and subject to worldwide
; patent protection (United States and foreign), United States copyright laws
; and international treaty provisions.  Therefore, you may use this Software
; only as provided in the license agreement accompanying the software package
; from which you obtained this Software ("EULA").
; If no EULA applies, Cypress hereby grants you a personal, non-exclusive,
; non-transferable license to copy, modify,
; and compile the Software source code solely for use in connection
; with Cypress's integrated circuit products.
; Any reproduction, modification, translation, compilation,
; or representation of this Software except as specified above is prohibited
; without the express written permission of Cypress.
; Disclaimer: THIS SOFTWARE IS PROVIDED AS-IS, WITH NO WARRANTY OF ANY KIND,
; EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, NONINFRINGEMENT,
; IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
; Cypress reserves the right to make changes to the Software without notice.
; Cypress does not assume any liability arising out of the application or
; use of the Software or any product or circuit described in the Software.
; Cypress does not authorize its products for use in any products
; where a malfunction or failure of the Cypress product may reasonably be
; expected to result in significant property damage,
; injury or death ("High Risk Product"). By including Cypress's product
; in a High Risk Product, the manufacturer of such system or application
; assumes all risk of such use and in doing so agrees to indemnify Cypress
; against all liability.


   AREA WDG_66_IA_TRIGGER, DATA, READONLY
   EXPORT Wdg_66_IA_TriggerFuncSize

Wdg_66_IA_TriggerFuncSize:
   .word    Wdg_66_IA_ActivateTrigger_end - Wdg_66_IA_ActivateTrigger

   AREA WDG_66_IA_TRIGGER, CODE
   EXPORT Wdg_66_IA_ActivateTrigger

   .thumb
; \brief Wdg_66_IA_ActivateTrigger
; This function triggers the watchdog.
Wdg_66_IA_ActivateTrigger:
#ifdef STACK_ANALYSIS_ENABLE
.scall Wdg_66_IA_ActivateTrigger, __leaf__
.maxstack Wdg_66_IA_ActivateTrigger, 0
#endif

   ; Judge watchdog type
   CMP          r0, 4
   BLT          MCWDT

WDT:
   ; Triggers the WDT
   LDR          r2, =#0x4026c000
   MOV          r0, 0x40
   ADD          r2, r2, r0
   ; Set LCOK register to unlock
   MOV          r0, 1
   STR          r0, [r2]
   NOP
   ; Set LCOK register to unlock
   MOV          r0, 2
   STR          r0, [r2]
   NOP
   ; Set SERVICE register to Service the watchdog
   MOVS         r0, 1
   STR          r0, [r2, 4]
   NOP
   ; Set LCOK register to lock
   MOVS         r0, 3
   STR          r0, [r2]
   NOP
   ; Go to end
   B          FINISH

MCWDT:
   ; Triggers the MCWDT
   LDR          r2, =#0x40268000
   
   ; Calculate address of LOCK of MCWDT[0-3]
   MOV          r1, 0x90
   ADD          r2, r2, r1
   LSL          r0, r0, 8
   ADD          r0, r0, r2

   ; Set LCOK register to unlock
   MOV          r2, 1
   STR          r2, [r0]
   NOP
   ; Set LCOK register to unlock
   MOV          r2, 2
   STR          r2, [r0]
   NOP
   ; Set SERVICE register to Service the watchdog
   MOV          r2, 1
   STR          r2, [r0, 4]
   NOP
   ; Set LCOK register to lock
   MOV          r2, 3
   STR          r2, [r0]
   NOP

FINISH:
   ret
.endf Wdg_66_IA_ActivateTrigger
   ; Locate literal pool here
   ALIGN 4
   LTORG
Wdg_66_IA_ActivateTrigger_end:

   END

